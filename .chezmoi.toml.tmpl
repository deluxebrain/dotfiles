{{- $installTypes := list "minimal" "full" -}}

{{- /* Prompts */ -}}
{{- $installType := promptChoiceOnce . "installType" "Install type" $installTypes (index . "installType" | default "minimal") -}}
{{- $installSoftwareUpdates := promptBoolOnce . "installSoftwareUpdates" "Install software updates" (index . "installSoftwareUpdates" | default false) -}}
{{- $installAppStorePackages := promptBoolOnce . "installAppStorePackages" "Install App Store packages" (index . "installAppStorePackages" | default false) -}}
{{- $fullName := promptStringOnce . "fullName" "Full name" (index . "fullName" | default "") -}}
{{- $gitUserName := promptStringOnce . "gitUserName" "Git user name" (index . "gitUserName" | default "") -}}
{{- $gitUserEmail := promptStringOnce . "gitUserEmail" "Git user email" (index . "gitUserEmail" | default "") -}}
{{- $generateSshKey := promptBoolOnce . "generateSshKey" "Generate default SSH keypair" (index . "generateSshKey" | default true) -}}
{{- $timezone := promptStringOnce . "timezone" "Timezone" (index . "timezone" | default "Europe/London") -}}

{{- /* Validate required fields */ -}}
{{- $errors := list -}}
{{- if not $fullName }}{{ $errors = append $errors "fullName" }}{{end -}}
{{- if not $gitUserName }}{{ $errors = append $errors "gitUserName" }}{{end -}}
{{- if not $gitUserEmail }}{{ $errors = append $errors "gitUserEmail" }}{{end -}}
{{- if $errors -}}
{{-   writeToStdout (printf "Error: required fields missing: %s\n" (join ", " $errors)) -}}
{{-   exit 1 -}}
{{- end -}}

[data]
    installType = {{ $installType | quote }}
    installSoftwareUpdates = {{ $installSoftwareUpdates }}
    installAppStorePackages = {{ $installAppStorePackages }}
    fullName = {{ $fullName | quote }}
    gitUserName = {{ $gitUserName | quote }}
    gitUserEmail = {{ $gitUserEmail | quote }}
    generateSshKey = {{ $generateSshKey }}
    timezone = {{ $timezone | quote }}

[scriptEnv]
    XDG_CONFIG_HOME = "{{ .chezmoi.homeDir }}/.config"
    XDG_DATA_HOME = "{{ .chezmoi.homeDir }}/.local/share"
    XDG_CACHE_HOME = "{{ .chezmoi.homeDir }}/.cache"
    XDG_STATE_HOME = "{{ .chezmoi.homeDir }}/.local/state"
    ZSH = "{{ .chezmoi.homeDir }}/.config/oh-my-zsh"
    ZSH_CUSTOM = "{{ .chezmoi.homeDir }}/.config/zsh_custom"
    HOMEBREW_PREFIX = "/opt/homebrew"
    ASDF_CONFIG_FILE="{{ .chezmoi.homeDir }}/.config/asdf/asdfrc"
    ASDF_DATA_DIR="{{ .chezmoi.homeDir }}/.local/share/asdf"
    TMUX_PLUGIN_MANAGER_PATH = "{{ .chezmoi.homeDir }}/.config/tmux/plugins/"
    VSCODE_PORTABLE = "{{ .chezmoi.homeDir }}/.local/share/vscode"
    VSCODE_EXTENSIONS = "{{ .chezmoi.homeDir }}/.local/share/vscode/extensions"
    KREW_ROOT = "{{ .chezmoi.homeDir }}/.local/share/krew"
